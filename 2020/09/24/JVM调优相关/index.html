<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>JVM调优相关 | 赵KK的个人博客 | 纠结体本体,同步记录日常笔记</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="JVM">
    <meta name="description" content="#线上系统CPU，内存与磁盘IO暴增，你会如何调优？①首先top命令确定到具体线程，将内存与io异常的线程记录 12345678910111213141516171819202122232425262728[root@zhaokk logs]# toptop - 16:48:59 up 2 days, 23:23,  1 user,  load average: 0.00, 0.01, 0.20T">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM调优相关">
<meta property="og:url" content="kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/index.html">
<meta property="og:site_name" content="赵KK的个人博客">
<meta property="og:description" content="#线上系统CPU，内存与磁盘IO暴增，你会如何调优？①首先top命令确定到具体线程，将内存与io异常的线程记录 12345678910111213141516171819202122232425262728[root@zhaokk logs]# toptop - 16:48:59 up 2 days, 23:23,  1 user,  load average: 0.00, 0.01, 0.20T">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://47.105.116.133:8080/upload/jvm/1.png">
<meta property="og:image" content="http://47.105.116.133:8080/upload/jvm/2.png">
<meta property="og:image" content="http://47.105.116.133:8080/upload/jvm/3.png">
<meta property="og:image" content="http://47.105.116.133:8080/upload/jvm/4.png">
<meta property="og:image" content="http://47.105.116.133:8080/upload/jvm/5.png">
<meta property="og:image" content="http://47.105.116.133:8080/upload/jvm/6.png">
<meta property="og:image" content="http://47.105.116.133:8080/upload/jvm/7.png">
<meta property="og:image" content="http://47.105.116.133:8080/upload/jvm/8.png">
<meta property="og:image" content="http://47.105.116.133:8080/upload/jvm/9.png">
<meta property="og:image" content="http://47.105.116.133:8080/upload/jvm/10.png">
<meta property="og:image" content="http://47.105.116.133:8080/upload/jvm/11.png">
<meta property="article:published_time" content="2020-09-24T02:35:48.000Z">
<meta property="article:modified_time" content="2020-09-28T05:50:50.630Z">
<meta property="article:author" content="赵KK">
<meta property="article:tag" content="JVM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://47.105.116.133:8080/upload/jvm/1.png">
    
        <link rel="alternate" type="application/atom+xml" title="赵KK的个人博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">赵KK</h5>
          <a href="mailto:1462018576@qq.com" title="1462018576@qq.com" class="mail">1462018576@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://47.105.116.133:8080/upload/258.jpg" target="_blank" >
                <i class="icon icon-lg icon-link"></i>
                微信公众号
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">JVM调优相关</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">JVM调优相关</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-09-24T02:35:48.000Z" itemprop="datePublished" class="page-time">
  2020-09-24
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    

<article id="post-JVM调优相关"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">JVM调优相关</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-09-24 10:35:48" datetime="2020-09-24T02:35:48.000Z"  itemprop="datePublished">2020-09-24</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>#线上系统CPU，内存与磁盘IO暴增，你会如何调优？<br>①首先top命令确定到具体线程，将内存与io异常的线程记录</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@zhaokk logs]# top</span><br><span class="line">top - <span class="number">16</span>:<span class="number">48</span>:<span class="number">59</span> up <span class="number">2</span> days, <span class="number">23</span>:<span class="number">23</span>,  <span class="number">1</span> user,  load average: <span class="number">0.00</span>, <span class="number">0.01</span>, <span class="number">0.20</span></span><br><span class="line">Tasks: <span class="number">1784</span> total,   <span class="number">2</span> running, <span class="number">1354</span> sleeping,   <span class="number">0</span> stopped, <span class="number">428</span> zombie</span><br><span class="line">%Cpu(s):  <span class="number">0.0</span> us,  <span class="number">0.0</span> sy,  <span class="number">0.0</span> ni,<span class="number">100.0</span> id,  <span class="number">0.0</span> wa,  <span class="number">0.0</span> hi,  <span class="number">0.0</span> si,  <span class="number">0.0</span> st</span><br><span class="line">KiB Mem :  <span class="number">1882736</span> total,    <span class="number">70640</span> free,  <span class="number">1526212</span> used,   <span class="number">285884</span> buff/cache</span><br><span class="line">KiB Swap:        <span class="number">0</span> total,        <span class="number">0</span> free,        <span class="number">0</span> used.    <span class="number">29260</span> avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND                                                                                                   </span><br><span class="line"><span class="number">17755</span> root      <span class="number">20</span>   <span class="number">0</span>  <span class="number">165676</span>   <span class="number">4060</span>   <span class="number">1600</span> R  <span class="number">3.2</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">00.79</span> top                                                                                                       </span><br><span class="line"><span class="number">15120</span> root      <span class="number">10</span> -<span class="number">10</span>  <span class="number">134524</span>   <span class="number">6240</span>   <span class="number">1140</span> S  <span class="number">1.0</span>  <span class="number">0.3</span>   <span class="number">1</span>:<span class="number">04.54</span> AliYunDun                                                                                                 </span><br><span class="line"> <span class="number">1325</span> root      <span class="number">10</span> -<span class="number">10</span>  <span class="number">438960</span>    <span class="number">676</span>     <span class="number">80</span> S  <span class="number">0.3</span>  <span class="number">0.0</span>  <span class="number">12</span>:<span class="number">14.54</span> AliSecGuard                                                                                               </span><br><span class="line"> <span class="number">7688</span> root      <span class="number">20</span>   <span class="number">0</span> <span class="number">2522072</span>  <span class="number">86580</span>   <span class="number">2172</span> S  <span class="number">0.3</span>  <span class="number">4.6</span>   <span class="number">0</span>:<span class="number">33.20</span> java                                                                                                      </span><br><span class="line">    <span class="number">1</span> root      <span class="number">20</span>   <span class="number">0</span>  <span class="number">120276</span>  <span class="number">60392</span>    <span class="number">640</span> S  <span class="number">0.0</span>  <span class="number">3.2</span>   <span class="number">4</span>:<span class="number">37.34</span> systemd                                                                                                   </span><br><span class="line">    <span class="number">2</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.01</span> kthreadd                                                                                                  </span><br><span class="line">    <span class="number">3</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">31.43</span> ksoftirqd/<span class="number">0</span>                                                                                               </span><br><span class="line">    <span class="number">5</span> root       <span class="number">0</span> -<span class="number">20</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> kworker/<span class="number">0</span>:<span class="number">0</span>H                                                                                              </span><br><span class="line">    <span class="number">7</span> root      rt   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> migration/<span class="number">0</span>                                                                                               </span><br><span class="line">    <span class="number">8</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> rcu_bh                                                                                                    </span><br><span class="line">    <span class="number">9</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> R  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">6</span>:<span class="number">31.17</span> rcu_sched                                                                                                 </span><br><span class="line">   <span class="number">10</span> root       <span class="number">0</span> -<span class="number">20</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> lru-add-drain                                                                                             </span><br><span class="line">   <span class="number">13</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> kdevtmpfs                                                                                                 </span><br><span class="line">   <span class="number">14</span> root       <span class="number">0</span> -<span class="number">20</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> netns                                                                                                     </span><br><span class="line">   <span class="number">15</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.69</span> khungtaskd                                                                                                </span><br><span class="line">   <span class="number">16</span> root       <span class="number">0</span> -<span class="number">20</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.03</span> writeback                                                                                                 </span><br><span class="line">   <span class="number">17</span> root       <span class="number">0</span> -<span class="number">20</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> kintegrityd                                                                                               </span><br><span class="line">   <span class="number">18</span> root       <span class="number">0</span> -<span class="number">20</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> bioset                                                                                                    </span><br><span class="line">   <span class="number">19</span> root       <span class="number">0</span> -<span class="number">20</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> bioset                                                                                                    </span><br><span class="line">   <span class="number">20</span> root       <span class="number">0</span> -<span class="number">20</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> bioset</span><br></pre></td></tr></table></figure>
<p>②查看磁盘IO </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sar -d -p <span class="number">1</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="number">09</span>:<span class="number">51</span>:<span class="number">48</span> AM       DEV       tps     rkB/s     wkB/s   areq-sz    aqu-sz     await     svctm     %util</span><br><span class="line"><span class="number">09</span>:<span class="number">51</span>:<span class="number">49</span> AM       vda      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></span><br><span class="line"><span class="number">09</span>:<span class="number">51</span>:<span class="number">50</span> AM       vda      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></span><br><span class="line">Average:          vda      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></span><br></pre></td></tr></table></figure>
<p>其中， “-d”参数代表查看磁盘性能，“-p”参数代表将 dev 设备按照 sda，sdb……名称显示，“1”代表每隔1s采取一次数值，“2”代表总共采取2次数值。<br>await：平均每次设备 I/O 操作的等待时间（以毫秒为单位）。<br>svctm：平均每次设备 I/O 操作的服务时间（以毫秒为单位）。<br>%util：一秒中有百分之几的时间用于 I/O 操作<br>磁盘IO标准:<br>正常情况下 svctm 应该是小于 await 值的，而 svctm 的大小和磁盘性能有关，CPU 、内存的负荷也会对 svctm 值造成影响，过多的请求也会间接的导致 svctm 值的增加。<br>await 值的大小一般取决与 svctm 的值和 I/O 队列长度以 及I/O 请求模式，如果 svctm 的值与 await 很接近，表示几乎没有 I/O 等待，磁盘性能很好，如果 await 的值远高于 svctm 的值，则表示 I/O 队列等待太长，系统上运行的应用程序将变慢，此时可以通过更换更快的硬盘来解决问题。<br>%util 项的值也是衡量磁盘 I/O 的一个重要指标，如果 %util 接近 100% ，表示磁盘产生的 I/O 请求太多，I/O 系统已经满负荷的在工作，该磁盘可能存在瓶颈。长期下去，势必影响系统的性能，可以通过优化程序或者通过更换更高、更快的磁盘来解决此问题<br>③.确定好具体线程后定位具体代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep <span class="number">2588</span>|grep -v grep</span><br></pre></td></tr></table></figure>
<p>④定位</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -mp <span class="number">2588</span> -o THREAD,tid,time</span><br></pre></td></tr></table></figure>
<p>⑤换算16进制后</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack <span class="number">2588</span> |grep a1d -A60</span><br></pre></td></tr></table></figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://47.105.116.133:8080/upload/jvm/1.png" alt="图1" title="">
                </div>
                <div class="image-caption">图1</div>
            </figure>
<p>接下来就处理是逻辑问题，还是代码，还是数据库问题了<br>2、你们JVM线上使用的什么垃圾回收器？CMS还是G1？<br>我们线上由于使用的java8，默认垃圾回收器G1，如果不知道，可以打印下GC，-XX:PrintGCDetails,<br>windows查看收集器</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://47.105.116.133:8080/upload/jvm/2.png" alt="图1" title="">
                </div>
                <div class="image-caption">图1</div>
            </figure>
<p>Linux 查看</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+PrintCommandLineFlags -version</span><br><span class="line">-XX:InitialHeapSize=<span class="number">260062400</span> -XX:MaxHeapSize=<span class="number">4160998400</span> -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC </span><br><span class="line">java version <span class="string">"1.8.0_261"</span></span><br><span class="line">Java(TM) <span class="function">SE Runtime <span class="title">Environment</span> <span class="params">(build <span class="number">1.8</span><span class="number">.0</span>_261-b12)</span></span></span><br><span class="line"><span class="function">Java <span class="title">HotSpot</span><span class="params">(TM)</span> 64-Bit Server <span class="title">VM</span> <span class="params">(build <span class="number">25.261</span>-b12, mixed mode)</span></span></span><br></pre></td></tr></table></figure>
<p>-XX:+UseParallelGC<br>垃圾收集器种类<br>垃圾回收器：并行  串行   并发标记(CMS)  G1    ZGC</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java15 ZGC转正</span><br><span class="line">ZGC 功能转正</span><br><span class="line">ZGC是一个可伸缩、低延迟的垃圾回收器。</span><br><span class="line">ZGC 已由JEP <span class="number">333</span>集成到JDK <span class="number">11</span> 中，其目标是通过减少 GC 停顿时间来提高性能。借助 JEP <span class="number">377</span>，JDK <span class="number">15</span> 将 ZGC 垃圾收集器从预览特性变更为正式特性而已，没错，转正了。</span><br><span class="line">这个 JEP 不会更改默认的 GC，默认仍然是 G1。</span><br></pre></td></tr></table></figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://47.105.116.133:8080/upload/jvm/3.png" alt="图" title="">
                </div>
                <div class="image-caption">图</div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://47.105.116.133:8080/upload/jvm/4.png" alt="图" title="">
                </div>
                <div class="image-caption">图</div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://47.105.116.133:8080/upload/jvm/5.png" alt="图" title="">
                </div>
                <div class="image-caption">图</div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://47.105.116.133:8080/upload/jvm/6.png" alt="图" title="">
                </div>
                <div class="image-caption">图</div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://47.105.116.133:8080/upload/jvm/7.png" alt="图" title="">
                </div>
                <div class="image-caption">图</div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://47.105.116.133:8080/upload/jvm/8.png" alt="图" title="">
                </div>
                <div class="image-caption">图</div>
            </figure>
<p>3、CMS的并发更新失败是怎么回事？如何优化？<br>CMS垃圾回收失败类型主要是两种：并发失效和晋升失败<br>并发失效<br>在新生代(YoungGen)发生垃圾回收时，达到晋升年龄的对象会被移动到老年代(OldGen)中。<br>如果老年代没有足够的空间容纳这个晋升对象，CMS为了腾出老年代空间，就会从本来的MinorGC退化成FullGC。<br>MinorGC只回收新生代，而FullGC不仅回收新生代，而且还会回收老年代，永久区(PermGen)或元区(MetaSpace)空间回收也可能随FullGC顺便执行。<br>本来只是简单的新生代回收工作扩大到老年代甚至更大。除此之外，老年代空间通常比新生代的Eden和Survivor区大得多，检查和清理无效对象的时间要多得多。<br>还有，FullGC回收的同时，所有进程必须StopTheWorld，并用单线程(SerialGC)开始垃圾回收。导致本来可以并发的MinorGC变得缓慢无比。<br>晋升失败<br>晋升失败同样是老年代导致的问题。<br>CMS开启新生代垃圾收集的时候，判断老年代似乎有足够空间容纳所有晋升对象。<br>然而晋升的时候才发现老年代的空间竟然都是碎片化的，根本容纳不了一个完整的晋升对象。<br>剩下出路只有内存整理。所有应用运行的线程停止，CMS开始对老年代进行整理和压缩。<br>空间压缩要通过移动里面的对象，令这些对象排列好，所以晋升失败比不需要移动对象的并发失效更加浪费时间。<br>完成清理的堆空间变得规整和空余，继续运行应用。<br>调优<br>并发失效调优：<br>令老生代垃圾回收提早，增大回收频率<br>增大老年代空间<br>增大新生代空间，提高对象滞留时间，更多新对象被回收而不是晋升。<br>增加更多后台回收线程<br>晋升失败调优：<br>有难度，因为CMS本身不能规整Compat内存，只能退化到SerialGC来做<br>尝试用G1，G1的内存模型更加先进<br>4、JVM是任何时刻都可以STW吗？为什么？<br>STW即停顿类型<br>垃圾回收并不会阻塞我们程序的线程，他是与当前程序并发执行的。所以问题就出在这里，当GC线程标记好了一个对象的时候，此时我们程序的线程又将该对象重新加入了“关系网”中，当执行二次标记的时候，该对象也没有重写finalize()方法，因此回收的时候就会回收这个不该回收的对象。<br>  虚拟机的解决方法就是在一些特定指令位置设置一些“安全点”，当程序运行到这些“安全点”的时候就会暂停所有当前运行的线程（Stop The World 所以叫STW），暂停后再找到“GC Roots”进行关系的组建，进而执行标记和清除<br>这些特定的指令（安全点）位置主要在：<br>1、循环的末尾<br>2、方法临返回前 / 调用方法的call指令后<br>3、可能抛异常的位置<br>那个停顿类型就是STW，至于有GC和Full GC之分，还有Full GC (System)。个人认为主要是Full GC时STW的时间相对GC来说时间很长，因为Full GC针对整个堆以及永久代的，因此整个GC的范围大大增加；还有就是他的回收算法就是我们之前说过的“标记–清除–整理”，这里也会损耗一定的时间。所以我们在优化JVM的时候，减少Full GC的次数也是经常用到的办法。<br>5、线上系统GC问题如何快速定位与分析？阿里巴巴的Arthas用过吗？<br>Arthas单独去学就好<br>6、单机几十万并发的系统JVM如何优化？<br>既然说了单机了，服务单机，就把中间件去集群化<br>redis+二级缓存+mq+数据库优化<br>7、高并发系统为何建议选择G1垃圾收集器？<br>上面G1特点已经讲过了<br>8、能说说Mysql索引底层B+树结构与算法吗？<br>B+树中的B代表平衡（balance），而不是二叉（binary）<br>B-Tree：平衡二叉树<br>特点：<br>        1.具有数据节点<br>        2.指向下层指针<br>        3.指向数据指针<br>缺页查询,产生IO<br>B+Tree：<br>特点:<br>       1.具有数据节点<br>       2.指向下层指针<br>命中数据3层查找后查询数据指针<br>加载更快，产生更少IO<br>效率：BTree更高，但从IO角度，Mysql选择B+Tree</p>
<p>B+tree算法<br>插入算法<br>删除算法</p>
<p><a href="https://www.codedump.info/post/20200615-btree-2/" target="_blank" rel="noopener">https://www.codedump.info/post/20200615-btree-2/</a><br>9、聚集索引与覆盖索引与索引下推到底是什么？<br>聚集索引和组合索引<br>索引<br>表的数据量比较大时，查询操作会很耗时。建立索引是加快查询速度的有效手段。<br>数据库索引就类似于书签，可以快速定位到要查询的内容。数据库索引类型<br>有顺序文件索引，B+树索引，散列索引，位图索引。其中B+树索引应用广泛。<br>在B+树上的查找，删除，插入的代价为O ( l o g N ) O(log N)O(logN)。建立索引有好处，当然也有<br>缺点。索引会占额外存储空间。每次数据更新时，也要用额外的时间来维护索引。</p>
<p>#聚集索引<br>一张表里面只能有一个聚集索引，一般设置主键为索引。<br>数据库中行数据的物理顺序和索引顺序相同。这样的索引称为聚集索引。<br>一张表只有一个物理顺序，也就只能有一个聚集索引。<br>#组合索引(覆盖索引)<br>定义：包含两个或多个属性列的索引称为复合索引。<br>#索引下推 Index Condition Pushdown<br>官网描述</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">The goal of ICP is to reduce the number of full-record </span><br><span class="line">reads and thereby reduce IO operations. For InnoDB clustered indexes,</span><br><span class="line">the complete record is already read into the InnoDB buffer.</span><br><span class="line">Using ICP in <span class="keyword">this</span> <span class="keyword">case</span> does not reduce IO.</span><br><span class="line">ICP的目标是减少完整记录读取的次数，从而减少IO操作。对于InnoDB聚集索引，</span><br><span class="line">完整的记录已经被读入InnoDB缓冲区。在这种情况下使用ICP不会减少IO。</span><br></pre></td></tr></table></figure>
<p>10、能说说Mysql并发支撑底层Buffer Pool机制吗？<br>一个缓冲池，来来回回还是缓存+池化思想那一套<br>11、一线互联网公司的数据库架构是如何设计的?<br>我愿意咋设计就咋设计(*￣︶￣)<br>先从业务逻辑上避免复杂关联库，冗余字段等<br>记录表等多次查询的字段建索引<br>多用标识性字段不用 is null等操作<br>12.阿里微服务分布式事务Seata源码深度剖析</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://47.105.116.133:8080/upload/jvm/9.png" alt="图" title="">
                </div>
                <div class="image-caption">图</div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://47.105.116.133:8080/upload/jvm/10.png" alt="图" title="">
                </div>
                <div class="image-caption">图</div>
            </figure>
<p>13:动态链接与常量池<br>大部分字节码质量在执行的时候，都需要常量池的访问<br>指向运行时常量池的方法引用<br>方法的绑定机制<br>静态链接:编译期可确定</p>
<p>动态链接:编译期无法确定</p>
<p>早期绑定:同</p>
<p>晚期绑定:同理</p>
<p>方法调用指令区分虚方法与非虚方法</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://47.105.116.133:8080/upload/jvm/11.png" alt="图" title="">
                </div>
                <div class="image-caption">图</div>
            </figure>
        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2020-09-28T05:50:50.630Z" itemprop="dateUpdated">2020-09-28 13:50:50</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/" target="_blank" rel="external">kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/</a>
        
    </div>
    
    <footer>
        <a href="kkget.github.io">
            <img src="/img/avatar.jpg" alt="赵KK">
            赵KK
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JVM/" rel="tag">JVM</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/&title=《JVM调优相关》 — 赵KK的个人博客&pic=kkget.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/&title=《JVM调优相关》 — 赵KK的个人博客&source=致力于技术分享，日常技术记录，日常bug记录等" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《JVM调优相关》 — 赵KK的个人博客&url=kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/&via=kkget.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/09/30/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%B3%BB%E5%88%97/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">数据库中间件系列</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/08/17/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AF%BC%E8%87%B4%E5%9B%BE%E7%89%87%E4%B8%8D%E6%98%BE%E7%A4%BA/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">【声明】阿里云服务器导致图片不显示</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'false' == 'true',
            verify: 'false' == 'true',
            appId: "5qofQKP6PLlRGj9AKdN2wFy8-gzGzoHsz",
            appKey: "MUjdIW5XaUutRWAdIFu4IdxP",
            avatar: "mm",
            placeholder: "Just do it",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->










</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
			<span style="text-align: center" id="sitetime"></span>
            <span>This blog is licensed under a <a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>赵KK &copy; 2018 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
<script language=javascript>
	function siteTime(){
		window.setTimeout("siteTime()", 1000);
		var seconds = 1000;
		var minutes = seconds * 60;
		var hours = minutes * 60;
		var days = hours * 24;
		var years = days * 365;
		var today = new Date();
		var todayYear = today.getFullYear();
		var todayMonth = today.getMonth()+1;
		var todayDate = today.getDate();
		var todayHour = today.getHours();
		var todayMinute = today.getMinutes();
		var todaySecond = today.getSeconds();
		/* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
		year - 作为date对象的年份，为4位年份值
		month - 0-11之间的整数，做为date对象的月份
		day - 1-31之间的整数，做为date对象的天数
		hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
		minutes - 0-59之间的整数，做为date对象的分钟数
		seconds - 0-59之间的整数，做为date对象的秒数
		microseconds - 0-999之间的整数，做为date对象的毫秒数 */
		var t1 = Date.UTC(2018,02,13,15,00,00); //北京时间2018-2-13 00:00:00
		var t2 = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
		var diff = t2-t1;
		var diffYears = Math.floor(diff/years);
		var diffDays = Math.floor((diff/days)-diffYears*365);
		var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
		var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
		var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
		document.getElementById("sitetime").innerHTML=" 本站点已运行"+/*diffYears+" 年 "+*/diffDays+" 天 "+diffHours+" 小时 "+diffMinutes+" 分钟 "+diffSeconds+" 秒";
	}/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
	siteTime();
</script>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/&title=《JVM调优相关》 — 赵KK的个人博客&pic=kkget.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/&title=《JVM调优相关》 — 赵KK的个人博客&source=致力于技术分享，日常技术记录，日常bug记录等" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《JVM调优相关》 — 赵KK的个人博客&url=kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/&via=kkget.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=kkget.github.io/2020/09/24/JVM%E8%B0%83%E4%BC%98%E7%9B%B8%E5%85%B3/" alt="微信分享二维码">
</div>






    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '你给我回来!';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



	<script type="text/javascript" src="/js/clicklove.js"></script>
	<!--单击显示文字-->
	<script type="text/javascript" src="/js/click_show_text.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/01/assets/haru01.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body>
</html>
